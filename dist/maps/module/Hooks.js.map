{"version":3,"sources":["module/Hooks.ts"],"names":[],"mappings":"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","file":"../../module/Hooks.js","sourcesContent":["\r\n// import * as Module from \"module\";\r\n// import { DND5E } from \"../../../systems/dnd5e/module/config.js\";\r\n//@ts-ignore\r\nimport ItemSheet5e from \"../../../systems/dnd5e/module/item/sheet.js\";\r\nimport { error, log, warn } from \"../main.js\";\r\nimport ContainerConfigApplication from \"./container-config.js\";\r\nimport { canvasReadyHook } from \"./hooks/canvas-ready-hook.js\";\r\nimport { createActorHook } from \"./hooks/create-actor-hook.js\";\r\nimport { createItemHook } from \"./hooks/create-item-hook.js\";\r\nimport { deleteItemHook } from \"./hooks/delete-item-hook.js\";\r\nimport { deleteTokenHook } from \"./hooks/delete-token-hook.js\";\r\nimport { lootTokenCreatedHook } from \"./hooks/loot-token-created-hook.js\";\r\nimport { preCreateItemHook } from \"./hooks/pre-create-item-hook.js\";\r\nimport { preUpdateItemHook } from \"./hooks/pre-update-item-hook.js\";\r\nimport { preUpdateTokenHook } from \"./hooks/pre-update-token-hook.js\";\r\nimport { renderItemDirectoryHook } from \"./hooks/render-item-directory-hook.js\";\r\nimport { onRenderLootHud } from \"./hooks/render-loot-hud-hook.js\";\r\nimport { updateItemHook } from \"./hooks/update-item-hook.js\";\r\nimport { LootHud } from \"./loot-hud-application.js\";\r\nimport { ItemFlags, TokenFlags } from \"./loot-token.js\";\r\nimport { addItemToContainer, createItem, createLootToken, createOwnedItem, createToken, deleteItem, deleteOwnedItem, deleteToken, dropItemOnToken, getLootToken, lootCurrency, lootItem, updateActor, updateItem, updateOwnedItem, updateToken } from \"./mainEntry.js\";\r\nimport { ItemType, PickUpStixHooks, SocketMessage, SocketMessageType } from \"./models.js\";\r\nimport { preloadTemplates } from \"./preloadTemplates.js\";\r\nimport { getCanvas, getGame, PICK_UP_STIX_FLAG, PICK_UP_STIX_MODULE_NAME, PICK_UP_STIX_SOCKET, registerSettings, SettingKeys } from \"./settings.js\";\r\nimport { amIFirstGm, canSeeLootToken, versionDiff } from \"./utils.js\";\r\n\r\nexport let readyHooks = async () => {\r\n\r\n\tlog(' ready once hook');\r\n\r\n\tif (getGame().system.id === 'dnd5e') {\r\n\t\tHooks.on('renderItemSheet5e', (app, protoHtml, data) => {\r\n\t\t\tlog(` renderItemSheet5e`);\r\n\t\t\tlog([app, protoHtml, data]);\r\n\r\n\t\t\tconst item: Item = app.object;\r\n\r\n\t\t\t// can't edit the size of owned items\r\n\t\t\tif (item.actor) return;\r\n\r\n\t\t\tlet html = protoHtml;\r\n\r\n\t\t\tif (html[0].localName !== \"div\") {\r\n\t\t\t\thtml = $(html[0].parentElement.parentElement);\r\n\t\t\t}\r\n\t\t\tconst flagValue = (<any>item.getFlag(PICK_UP_STIX_MODULE_NAME,PICK_UP_STIX_FLAG))?.tokenData;\r\n\t\t\tconst widthValue = flagValue?.width ?? 1; // ${item.data.flags?.['pick-up-stix']?.['pick-up-stix']?.tokenData?.width ?? 1}\r\n\t\t\tconst heightValue = flagValue?.height ?? 1; // ${item.data.flags?.['pick-up-stix']?.['pick-up-stix']?.tokenData?.height ?? 1}\r\n\t\t\tconst content = `\r\n\t\t\t<div class=\"form-group\">\r\n\t\t\t\t<label>Width</label>\r\n\t\t\t\t<input type=\"text\" name=\"flags.pick-up-stix.pick-up-stix.tokenData.width\" value=\"${widthValue}\" data-dtype=\"Number\">\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"form-group\">\r\n\t\t\t\t<label>Height</label>\r\n\t\t\t\t<input type=\"text\" name=\"flags.pick-up-stix.pick-up-stix.tokenData.height\" value=\"${heightValue}\" data-dtype=\"Number\">\r\n\t\t\t</div>\r\n\t\t\t`\r\n\t\t\t$(html)\r\n\t\t\t\t.find('div.item-properties div.form-group')\r\n\t\t\t\t.last()\r\n\t\t\t\t.after(content);\r\n\t\t});\r\n\r\n\t\t//@ts-ignore\r\n\t\t// Items.registerSheet(getGame().system.id, ItemSheet5e, {makeDefault: false, types:[ItemType.CONTAINER]});\r\n\t}\r\n\r\n\t// RMEOVED ON VERSION 2.0.0 (FoundryVTT 0.8.8)\r\n\t// if (getGame().user?.isGM) {\r\n\t// \t//@ts-ignore\r\n\t// \tgetGame().modules?.get(PICK_UP_STIX_MODULE_NAME).apis = {};\r\n\t// \t//@ts-ignore\r\n\t// \tgetGame().modules?.get(PICK_UP_STIX_MODULE_NAME).apis.v = 1;\r\n\t// \t//@ts-ignore\r\n\t// \tgetGame().modules?.get(PICK_UP_STIX_MODULE_NAME).apis.makeContainer = makeContainerApi;\r\n\t// }\r\n\r\n\t// this adds the 'container' type to the game system's entity types.\r\n\tgetGame().system.entityTypes.Item.push(ItemType.CONTAINER);\r\n\r\n\t// add the default sheet to the container Item type\r\n\tCONFIG.Item.sheetClasses[ItemType.CONTAINER] = {\r\n\t\t'pick-up-stix.ContainerConfigApplication': {\r\n\t\t\tlabel: 'pick-up-stix.ContainerConfigApplication',\r\n\t\t\tcls: ContainerConfigApplication,\r\n\t\t\tdefault: true,\r\n\t\t\tid: 'pick-up-stix.ContainerConfigApplication'\r\n\t\t}\r\n\t};\r\n\r\n\tif (amIFirstGm()) {\r\n\t\tawait createDefaultFolders();\r\n\t}\r\n\tlet scenes = getGame().scenes || [];\r\n\tfor (let el of scenes) { // Scene.collection\r\n\t\tlet scene = (el as unknown) as Scene;\r\n\t\tlet tokens = scene.getEmbeddedCollection('Token');\r\n\t\tfor (let token of tokens) {\r\n\t\t\t//const tokenFlags: TokenFlags = getProperty(token, 'flags.pick-up-stix.pick-up-stix');\r\n\t\t\tconst tokenFlags: TokenFlags = token.getFlag(PICK_UP_STIX_MODULE_NAME, PICK_UP_STIX_FLAG);\r\n\t\t\tif (!tokenFlags) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet lootToken = getLootToken({ itemId: tokenFlags?.itemId, tokenId: <string>token.id })?.[0];\r\n\r\n\t\t\tif (tokenFlags?.itemId && !lootToken) {\r\n\t\t\t\tlog(` readyHook | Creating new LootToken for Token '${token.id}' and Item '${tokenFlags.itemId}'`);\r\n\t\t\t\tlootToken = await createLootToken(<string>token.id, tokenFlags.itemId, false);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tscene = <Scene>getGame().scenes?.active;\r\n\t\ttokens = scene.getEmbeddedCollection('Token');\r\n\t\tfor (let token of tokens) {\r\n\t\t\tconst tokenFlags: TokenFlags = getProperty(token, 'flags.pick-up-stix.pick-up-stix');\r\n\t\t\tif (!tokenFlags) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet lootTokens = getLootToken({ itemId: tokenFlags?.itemId, tokenId: <string>token.id });\r\n\t\t\tfor(let lt of lootTokens) {\r\n\t\t\t\tif (tokenFlags.isLocked) {\r\n\t\t\t\t\tlt.drawLock();\r\n\t\t\t\t}\r\n\t\t\t\tlt.activateListeners();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tconst items = <IterableIterator<Item>>getGame().items?.values();\r\n\tfor (let item of items) {\r\n\t\t//if (getProperty(item, 'data.flags.pick-up-stix.pick-up-stix.itemType') === ItemType.CONTAINER) {\r\n\t\tif ((<ItemFlags>item.getFlag(PICK_UP_STIX_MODULE_NAME,PICK_UP_STIX_FLAG))?.itemType === ItemType.CONTAINER) {\r\n\t\t\titem.data.type = ItemType.CONTAINER;\r\n\t\t}\r\n\t}\r\n\r\n\tconst activeVersion = <string>getGame().modules?.get(PICK_UP_STIX_MODULE_NAME)?.data.version;\r\n\tconst previousVersion = <string>getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.version);\r\n\r\n\tif (amIFirstGm() && activeVersion !== previousVersion) {\r\n\t\tawait getGame().settings.set('pick-up-stix', SettingKeys.version, activeVersion);\r\n\t}\r\n\r\n\tconst diff = versionDiff(activeVersion, previousVersion);\r\n\tif (diff < 0) {\r\n\t\tlog(` readyHook | current version ${activeVersion} is lower than previous version ${previousVersion}`);\r\n\t}\r\n\telse if (diff > 0) {\r\n\t\tlog(` readyHook | current version ${activeVersion} is greater than previous version ${previousVersion}`);\r\n\t}\r\n\telse {\r\n\t\tlog(` readyHook | current version ${activeVersion} the same as the previous version ${previousVersion}`);\r\n\t}\r\n\r\n\tconst el = document.createElement('div');\r\n\tel.innerHTML = `<p>I have made some improvements that should hopefully speed up the module but want to point out a few changes</p>\r\n\t<p>First off you'll notice new Item folders have been created. A parent folder named <strong>Pick-Up-Stix</strong>\r\n\tand two folders within there named <strong>Items</strong>, and <strong>Tokens</strong>. Once these folders have been created, you\r\n\tare free to move them around however, if you delete them as of now there is no way to recover any previous contents,\r\n\tthough the folder should be recreated on the next startup. These folders can not be seen by players that are not GMs.</p>\r\n\t<p>The <strong>Tokens</strong> folder contains Items that represent any loot token instances that are in a scene. If you edit one of them\r\n\tfrom the Items directory, then you will edit all loot token instances attached to it. If you want to create another instance,\r\n\tsimply drag one of the Items from the <strong>Tokens</strong> Item folder and you'll have a copy of that Item that will\r\n\tupdate when it updates. If you delete an Item from the <strong>Tokens</strong> folder, then all loot token instances will\r\n\tbe removed from all scenes. If you delete all loot token instances from all scenes, the Item associated with it in the\r\n\t<strong>Tokens</strong> folder will also be deleted</p>\r\n\t<p>The <strong>Items</strong> folder is a template folder. When you create an Item and choose the 'container' type, you'll get\r\n\tan Item created in the <strong>Items</strong> folder. If you drag one of these onto the canvas, you'll create a new loot token\r\n\tbased on the properties of that Item, but you'll notice that a new Item is created in the <strong>Tokens</strong> folder. You can\r\n\tupdated this new loot token by either updating it's new corresponding Item or through the token's config menu. You can\r\n\talso update that token and then drag a copy of it from the <strong>Tokens</strong> folder NOT the <strong>Items</strong> folder to\r\n\tcreate a new loot token with the udpated properties. Items in the <strong>Items</strong> folder are not deleted when any\r\n\tloot tokens created from them are deleted, nor are any loot tokens deleted when any Items in the <strong>Items</strong> directory\r\n\tare removed. Currently, only container-type Items are treated as templates since item-type Items are already their own templates.</p>`;\r\n\r\n\tif (amIFirstGm() && !getGame().settings.get('pick-up-stix', SettingKeys.version13updatemessage)) {\r\n\tnew Dialog({\r\n\ttitle: 'Pick-Up-Stix - Update notification',\r\n\tbuttons: {\r\n\t\t'OK': {\r\n\t\tlabel: 'OK'\r\n\t\t}\r\n\t},\r\n\tdefault: 'OK',\r\n\tcontent: el.innerHTML\r\n\t}, {\r\n\t\twidth: 750,\r\n\theight: 'auto'\r\n\t}).render(true);\r\n\tawait getGame().settings.set(PICK_UP_STIX_MODULE_NAME, SettingKeys.version13updatemessage, true);\r\n\t}\r\n\r\n\tgetGame().socket?.on(PICK_UP_STIX_SOCKET, handleSocketMessage);\r\n\r\n\tHooks.once('canvasReady', () => {\r\n\t\t//@ts-ignore\r\n\t\tgetCanvas().hud.pickUpStixLootHud = new LootHud();\r\n\t});\r\n\tHooks.on('canvasReady', canvasReadyHook);\r\n\t//Hooks.on('ready', readyHook);\r\n\r\n\t// item hooks\r\n\tHooks.on('preCreateItem', preCreateItemHook);\r\n\tHooks.on('createItem', createItemHook);\r\n\tHooks.on('preUpdateItem', preUpdateItemHook);\r\n\tHooks.on('updateItem', updateItemHook);\r\n\tHooks.on('deleteItem', deleteItemHook);\r\n\r\n\t// directory hooks\r\n\tHooks.on('renderItemDirectory', renderItemDirectoryHook);\r\n\r\n\t// actor hooks\r\n\tHooks.on('createActor', createActorHook);\r\n\r\n\t// token hooks\r\n\tHooks.on('deleteToken', deleteTokenHook);\r\n\tHooks.on('preUpdateToken', preUpdateTokenHook);\r\n\r\n\r\n\t// render hooks\r\n\t// Hooks.on(\"renderSettingsConfig\", (app, html, user) => {\r\n\t// \tprocessHtml(html);\r\n\t// });\r\n\tHooks.on('renderLootHud', onRenderLootHud);\r\n\r\n\tHooks.on(PickUpStixHooks.lootTokenCreated, lootTokenCreatedHook);\t\r\n}\r\n\r\nexport const setupHooks = async () => {\r\n\r\n  \t// setup all the hooks\r\n\t// game startup hooks\r\n\t\r\n\t\r\n}\r\n\r\nexport const initHooks = async () => {\r\n  \twarn(\"Init Hooks processing\");\r\n  \tlog('initHook');\r\n\r\n\t//Hooks.once('init', initHook);\r\n\r\n\t// CONFIG.debug.hooks = true;\r\n\t// CONFIG.debug['pickUpStix'] = true;\r\n\r\n\t// Assign custom classes and constants here\r\n\r\n\t// Register custom module settings\r\n\tregisterSettings();\r\n\r\n\t// Preload Handlebars templates\r\n\tawait preloadTemplates();\r\n\r\n\t// Token.prototype.release = Token_tokenRelease(Token.prototype.release);\r\n\r\n\t//@ts-ignore\r\n\tlibWrapper.register(PICK_UP_STIX_MODULE_NAME,\"Token.prototype.release\", TokenPrototypeReleaseHandler, \"MIXED\");\r\n\t//@ts-ignore\r\n\tlibWrapper.register(PICK_UP_STIX_MODULE_NAME,\"Token.prototype.isVisible\", TokenPrototypeIsVisibleHandler, \"MIXED\");\r\n\r\n\t// if (getGame().system.id === 'dnd5e') {\r\n\t// \tinfo(`pick-up-stix | initHook | System is '${getGame().system.id}' enabling Token.isVisible override.`);\r\n\r\n\t// \tObject.defineProperty(Token.prototype, 'isVisible', {\r\n\t// \t\tget: Token_isVisible,\r\n\t// \t\tenumerable: true,\r\n\t// \t\tconfigurable: true\r\n\t// \t});\r\n\t// }\r\n\t\r\n}\r\n\r\n\r\nexport const TokenPrototypeReleaseHandler = function (wrapped, ...args) {\r\n\tconst [ options ] = args;\r\n\tlog(` tokenRelease | called with args`);\r\n\tlog(options);\r\n\t//origFn.call(this, options);\r\n\t//@ts-ignore\r\n\tif (getCanvas().hud.pickUpStixLootHud?.object === this) {\r\n\t\t//@ts-ignore\r\n\t\tgetCanvas().hud.pickUpStixLootHud.clear();\r\n\t}\r\n\treturn wrapped(...args);\t\r\n}\r\n\r\nexport const TokenPrototypeIsVisibleHandler = function (wrapped, ...args) {\r\n\tlog(` Token_isVisible | called with args`);\r\n\twarn(` Token_isVisible | This method overrides isVisible of Token`);\r\n\tlet actualIsVisible: boolean;\r\n\tif ( this.data.hidden ) {\r\n\t\tconst tokenFlags: TokenFlags = this.getFlag(PICK_UP_STIX_MODULE_NAME, PICK_UP_STIX_FLAG);\r\n\t\tactualIsVisible = getGame().user?.isGM || (tokenFlags && canSeeLootToken(this))\r\n\t}\r\n\telse if (!getCanvas().sight?.tokenVision) {\r\n\t\tactualIsVisible = true;\r\n\t}\r\n\telse if ( this._controlled ) {\r\n\t\tactualIsVisible = true;\r\n\t}\r\n\telse {\r\n\t\tconst tolerance = Math.min(this.w, this.h) / 4;\r\n\t\tactualIsVisible = <boolean>getCanvas().sight?.testVisibility(this.center, {tolerance});\r\n\t}\r\n\treturn wrapped(...args);\r\n}\r\n\r\nconst createDefaultFolders = async () => {\r\n\tlog(` createDefaultFolders`);\r\n\r\n\t// check if the parent folder exists and create it if not\r\n\tlet parentFolderId = <string>getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.parentItemFolderId);\r\n\tlet folder = <Folder>getGame().folders?.get(parentFolderId);\r\n\t//let folder = Folder.collection.get(parentFolderId);\r\n\r\n\tif (!folder) {\r\n\t\tlog(` createDefaultFolders | couldn't parent folder creating it now`);\r\n\t\tfolder = <Folder>await Folder.create({\r\n\t\t\tcolor: '',\r\n\t\t\tname: 'Pick-Up-Stix',\r\n\t\t\tsorting: 'a',\r\n\t\t\tparent: null,\r\n\t\t\ttype: 'Item'\r\n\t\t});\r\n\t\tparentFolderId = <string>folder.id;\r\n\t\tawait getGame().settings.set(PICK_UP_STIX_MODULE_NAME, SettingKeys.parentItemFolderId, parentFolderId);\r\n\t}\r\n\telse {\r\n\t\tlog(` createDefaultFolders | parent folder '${folder.name}' found`);\r\n\t}\r\n\r\n\t// check if the tokens folder exist and create it if not\r\n\tfolder = <Folder>getGame().folders?.get(<string>getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.tokenFolderId));\r\n\t//folder = Folder.collection.get(getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.tokenFolderId));\r\n\r\n\tif (!folder) {\r\n\t\tlog(` createDefaultFolders | couldn't find tokens folder, creating it now`);\r\n\t\tfolder = <Folder>await Folder.create({\r\n\t\t\tcolor: '',\r\n\t\t\tname: 'Tokens',\r\n\t\t\tsorting: 'a',\r\n\t\t\tparent: <string>parentFolderId,\r\n\t\t\ttype: 'Item'\r\n\t\t});\r\n\t\tawait getGame().settings.set(PICK_UP_STIX_MODULE_NAME, SettingKeys.tokenFolderId, folder.id);\r\n\t}\r\n\telse {\r\n\t\tlog(` createDefaultFolders | tokens folder '${folder.name}' found`);\r\n\t}\r\n\r\n\t// check if the items folder exists and create it if not\r\n\tfolder = <Folder>getGame().folders?.get(<string>getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.itemFolderId));\r\n\t//folder = Folder.collection.get(getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.itemFolderId));\r\n\r\n\tif (!folder) {\r\n\t\tlog(` createDefaultFolders | couldn't find items folder`);\r\n\t\tfolder = <Folder>await Folder.create({\r\n\t\t\tcolor: '',\r\n\t\t\tname: 'Items',\r\n\t\t\tsorting: 'a',\r\n\t\t\tparent: <string>parentFolderId,\r\n\t\t\ttype: 'Item'\r\n\t\t});\r\n\t\tawait getGame().settings.set('pick-up-stix', SettingKeys.itemFolderId, folder.id);\r\n\t}\r\n\telse {\r\n\t\tlog(` createDefaultFolders | items folder '${folder.name}' found`);\r\n\t}\r\n};\r\n\r\nexport const handleSocketMessage = async (msg: SocketMessage) => {\r\n\tlog(` handleSocketMessage | received socket message with args:`);\r\n\tlog([msg]);\r\n\r\n\tif (handleNonGMMessage(msg)) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t/* if (msg.sender === getGame().user.id) {\r\n\t\tlog(` handleSocketMessage | i sent this, ignoring`);\r\n\t\treturn;\r\n\t} */\r\n\r\n\tif (!amIFirstGm()) {\r\n\t\t return;\r\n\t}\r\n\r\n\tswitch (msg.type) {\r\n\t\tcase SocketMessageType.deleteOwnedItem:\r\n\t\t\tawait deleteOwnedItem(msg.data.actorId, msg.data.itemId);\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.updateOwnedItem:\r\n\t\t\tawait updateOwnedItem(msg.data.actorId, msg.data.data);\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.updateActor:\r\n\t\t\tawait updateActor(<Actor>getGame().actors?.get(msg.data.actorId), msg.data.updates);\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.deleteToken:\r\n\t\t\tawait deleteToken(msg.data.tokenId, msg.data.sceneId);\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.updateItem:\r\n\t\t\tawait updateItem(msg.data.id, msg.data.updates);\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.updateToken:\r\n\t\t\tawait updateToken(msg.data.sceneId, msg.data.updates);\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.createOwnedItem:\r\n\t\t\tawait createOwnedItem(msg.data.actorId, msg.data.items);\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.createToken:\r\n\t\t\tawait createToken(msg.data);\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.createItem:\r\n\t\t\tawait createItem(msg.data.data, msg.data.options);\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.deleteItem:\r\n\t\t\tawait deleteItem(msg.data.id);\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.collectItem:\r\n\t\t\tawait lootItem(msg.data);\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.lootCurrency:\r\n\t\t\tawait lootCurrency(msg.data);\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.addItemToContainer:\r\n\t\t\tawait addItemToContainer(msg.data);\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.dropItemOnToken:\r\n\t\t\tawait dropItemOnToken(msg.data);\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\terror(` handleSocketMessage | No valid socket message handler for '${msg.type}' with arg:`);\r\n\t\t\tlog([msg])\r\n\t}\r\n};\r\n\r\nconst handleNonGMMessage = (msg: SocketMessage): boolean => {\r\n  let handled = false;\r\n\r\n  switch (msg.type) {\r\n    case SocketMessageType.lootTokenCreated:\r\n      Hooks.callAll(PickUpStixHooks.lootTokenCreated, msg.data.tokenId);\r\n      handled = true;\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.itemCollected:\r\n      Hooks.callAll(PickUpStixHooks.itemCollected, msg.data);\r\n      handled = true;\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.currencyLooted:\r\n      Hooks.callAll(PickUpStixHooks.currencyLooted, msg.data);\r\n      handled = true;\r\n\t\t\tbreak;\r\n\t\tcase SocketMessageType.itemAddedToContainer:\r\n      Hooks.callAll(PickUpStixHooks.itemAddedToContainer, msg.data);\r\n      handled = true;\r\n\t\t\tbreak;\r\n  }\r\n\r\n  return handled;\r\n};"]}