{"version":3,"sources":["module/hooks/pre-create-item-hook.ts"],"names":[],"mappings":"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","file":"../../../module/hooks/pre-create-item-hook.js","sourcesContent":["import { ItemType } from \"../models\";\r\nimport { getGame, PICK_UP_STIX_FLAG, PICK_UP_STIX_MODULE_NAME, SettingKeys } from \"../settings\";\r\nimport { ItemFlags } from \"../loot-token\";\r\nimport { error, log } from '../../main';\r\nimport { getCurrencyTypes } from \"../utils\";\r\n\r\nexport async function preCreateItemHook(itemData: any, options: any = {}, userId: string) {\r\n\tlog(` preCreateItemHook | called with args:`);\r\n\tlog([itemData, options, userId]);\r\n\r\n\tif (itemData.type.toLowerCase() === ItemType.CONTAINER) {\r\n\t\tlog(' preCreateItemHook');\r\n\r\n\t\tconst itemFlags: ItemFlags = {\r\n\t\t\ttokenData: {\r\n\t\t\t\twidth: 1,\r\n\t\t\t\theight: 1,\r\n\t\t\t\tname: itemData.name,\r\n\t\t\t\timg: itemData.img ?? getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.closeImagePath),\r\n\t\t\t\tdisposition: 0,\r\n\t\t\t\t...itemData.flags?.[PICK_UP_STIX_MODULE_NAME]?.[PICK_UP_STIX_FLAG]?.tokenData ?? {}\r\n\t\t\t},\r\n\t\t\tcontainer: {\r\n\t\t\t\tcurrency: Object.keys(getCurrencyTypes()).reduce((acc, shortName) => ({...acc, [shortName]: 0}), {}),\r\n\t\t\t\timageOpenPath: getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.openImagePath),\r\n\t\t\t\timageClosePath: getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.closeImagePath),\r\n\t\t\t\tsoundClosePath: getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.defaultContainerCloseSound),\r\n\t\t\t\tsoundOpenPath: getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.defaultContainerOpenSound),\r\n\t\t\t\t...itemData.flags?.[PICK_UP_STIX_MODULE_NAME]?.[PICK_UP_STIX_FLAG]?.container ?? {}\r\n\t\t\t},\r\n\t\t\titemType: ItemType.CONTAINER\r\n\t\t};\r\n\r\n\t\tmergeObject(itemData, {\r\n\t\t\t// we checked for item type being container, but that isn't a \"valid\" type. The type of item has to be included in the\r\n\t\t\t// getGame().system.entityTypes.Item array. So we look for one that is \"container-like\"; backbpack because that's one that dnd\r\n\t\t\t// 5e uses, and if we don't find that we just take whatever thed first item type is. Really it doesn't even matter right now\r\n\t\t\t// as the type of this item isn't important, we use the flags itemType property to determine if it's an item or a container\r\n\t\t\t// anywhere else anyway\r\n\t\t\ttype: getGame().system.entityTypes.Item.includes('backpack') ? 'backpack' : getGame().system.entityTypes.Item[0],\r\n\t\t\tfolder: itemData.folder || getGame().settings.get('pick-up-stix', SettingKeys.itemFolderId),\r\n\t\t\timg: itemFlags.tokenData.img,\r\n\t\t\tflags: {\r\n\t\t\t\t'pick-up-stix': {\r\n\t\t\t\t\t'pick-up-stix': itemFlags\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\toptions.renderSheet = false;\r\n\t}\r\n\r\n\tlog(` preCreateItemHook | final data:`);\r\n\r\n\tlog(itemData);\r\n}"]}