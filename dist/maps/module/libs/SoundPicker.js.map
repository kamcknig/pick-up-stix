{"version":3,"sources":["module/libs/SoundPicker.ts"],"names":[],"mappings":"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","file":"../../../module/libs/SoundPicker.js","sourcesContent":["import DirectoryPicker from './DirectoryPicker';\n\n/**\n * Game Settings: SoundPicker\n * @href https://github.com/MrPrimate/vtta-tokenizer/blob/master/src/libs/SoundPicker.js\n */\nclass SoundPicker extends FilePicker {\n  constructor(options = {}) {\n    super(options);\n  }\n\n  _onSubmit(event) {\n    event.preventDefault();\n    const path = event.target.file.value;\n    const activeSource = this.activeSource;\n    const bucket = event.target.bucket ? event.target.bucket.value : null;\n    //@ts-ignore\n    this.field.value = SoundPicker.format({\n      activeSource,\n      bucket,\n      path,\n    });\n    this.close();\n  }\n\n  static async uploadToPath(path, file) {\n    const options = DirectoryPicker.parse(path);\n    return FilePicker.upload(options.activeSource, options.current, file, { bucket: options.bucket });\n  }\n\n  // returns the type \"Img\" for rendering the SettingsConfig\n  static Sound(val) {\n    return val === null ? '' : String(val);\n  }\n\n  // formats the data into a string for saving it as a GameSetting\n  static format(value) {\n    return value.bucket !== null\n      ? `[${value.activeSource}:${value.bucket}] ${value.path}`\n      : `[${value.activeSource}] ${value.path}`;\n  }\n\n  // parses the string back to something the FilePicker can understand as an option\n  static parse(inStr) {\n    const str = inStr ?? '';\n    let matches = str.match(/\\[(.+)\\]\\s*(.+)?/u);\n    if (matches) {\n      let [, source, current = ''] = matches;\n      current = current.trim();\n      const [s3, bucket] = source.split(':');\n      if (bucket !== undefined) {\n        return {\n          activeSource: s3,\n          bucket: bucket,\n          current: current,\n        };\n      } else {\n        return {\n          activeSource: s3,\n          bucket: null,\n          current: current,\n        };\n      }\n    }\n    // failsave, try it at least\n    return {\n      activeSource: 'data',\n      bucket: null,\n      current: str,\n    };\n  }\n\n  // Adds a FilePicker-Simulator-Button next to the input fields\n  static processHtml(html) {\n    $(html)\n      .find(`input[data-dtype=\"Img\"]`)\n      .each((index, element) => {\n        $(element).prop('readonly', true);\n\n        if (!$(element).next().length) {\n          let picker = new SoundPicker({\n            field: $(element)[0],\n            //@ts-ignore\n            ...SoundPicker.parse(this.value),\n          });\n          // data-type=\"sound\" data-target=\"sound\"\n          let pickerButton = $(\n            '<button type=\"button\" class=\"file-picker\" title=\"Pick sound\"><i class=\"fas fa-file-import fa-fw\"></i></button>',\n          );\n          pickerButton.on('click', () => {\n            picker.render(true);\n          });\n          $(element).parent().append(pickerButton);\n        }\n      });\n  }\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    // remove unnecessary elements\n    $(html).find('footer button').text('Select sound');\n  }\n}\n\n// eslint-disable-next-line no-unused-vars\nHooks.on('renderSettingsConfig', (app, html, user) => {\n  SoundPicker.processHtml(html);\n});\n\nexport default SoundPicker;\n"]}