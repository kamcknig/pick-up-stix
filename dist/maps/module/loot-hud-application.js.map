{"version":3,"sources":["module/loot-hud-application.ts"],"names":[],"mappings":"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","file":"../../module/loot-hud-application.js","sourcesContent":["import { getLootToken } from './mainEntry';\nimport { LootEmitLightConfigApplication } from './loot-emit-light-config-application';\nimport { error, log } from '../main';\nimport {\n  getGame,\n  PICK_UP_STIX_FLAG,\n  PICK_UP_STIX_ITEM_ID_FLAG,\n  PICK_UP_STIX_MODULE_NAME,\n  SettingKeys,\n} from './settings';\n\nexport class LootHud extends BasePlaceableHUD<Token> {\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      height: <string | null | undefined>'auto',\n      minimizable: false,\n      id: 'loot-hud',\n      resizable: false,\n      template: `/modules/${PICK_UP_STIX_MODULE_NAME}/templates/loot-hud.html`,\n      classes: ['pick-up-stix', 'loot-hud'].concat(super.defaultOptions.classes),\n    });\n  }\n\n  private get itemId(): string {\n    return <string>this.object?.document.getFlag(PICK_UP_STIX_MODULE_NAME, PICK_UP_STIX_ITEM_ID_FLAG);\n  }\n\n  constructor() {\n    super({});\n    log(` LootHud ${this.appId} | constructor called with args`);\n    log(LootHud.defaultOptions);\n  }\n\n  activateListeners(html) {\n    log(` LootHud ${this.appId} | activateListeners called with args`);\n    log([html]);\n    super.activateListeners(html);\n    html.find('.config').click(this.onTokenConfig);\n    html.find('.locked').click(this._onToggleItemLocked);\n    html.find('.emit-light').click(this.onConfigureLightEmission);\n    html.find('.visibility-perceive-input').on('change', this.onPerceiveValueChanged);\n  }\n\n  private onPerceiveValueChanged = (e) => {\n    log(` LootHudApplication ${this.appId} | onPerceivedValueChanged`);\n    const val = +e.currentTarget.value;\n    log([val]);\n\n    if (val === undefined || val === null || isNaN(val)) {\n      ui.notifications?.error(`Invalid value '${val}'`);\n      return;\n    }\n\n    if (val < 0) {\n      ui.notifications?.error(`Minimum perceived value must be 0`);\n      return;\n    }\n\n    this.object?.document.update({\n      flags: {\n        'pick-up-stix': {\n          'pick-up-stix': {\n            minPerceiveValue: val,\n          },\n        },\n      },\n    });\n  };\n\n  private onConfigureLightEmission = async (event) => {\n    log(` LootHud ${this.appId} | _onConfigureLightEmission`);\n    const f = new LootEmitLightConfigApplication(this.object, {}).render(true);\n  };\n\n  private _onToggleItemLocked = async (event) => {\n    log(` LootHud ${this.appId} | _onToggleItemLocked`);\n    const lootToken = getLootToken({ itemId: this.itemId, tokenId: <string>this.object?.document.id })?.[0];\n\n    if (!lootToken) {\n      error(\n        `No valid LootToken instance found for token '${<string>this.object?.document.id}' and Item id '${\n          this.itemId\n        }'`,\n      );\n      return;\n    }\n\n    await lootToken.toggleLocked();\n    this.render();\n  };\n\n  private onTokenConfig = async (event) => {\n    log(` LootHud ${this.appId} | _onTokenConfig`);\n\n    const item = <Item>getGame().items?.get(this.itemId);\n    item.sheet?.render(true, { renderData: { sourceToken: this.object?.document.data._id } });\n  };\n\n  getData(options?: Application.RenderOptions) {\n    log(` LootHud ${this.appId} | getData`);\n    const lootData = getLootToken({ itemId: this.itemId, tokenId: <string>this.object?.document.id })?.[0];\n    if (!lootData) {\n      //@ts-ignore\n      error(\n        `No valid LootToken instance found for token '${this.object?.document.id}' on scene '${\n          (<Token>this.object)?.scene?.id\n        }'`,\n      );\n    }\n\n    const data: any = {\n      canConfigure: getGame().user?.can('TOKEN_CONFIGURE'),\n      visibilityClass: this.object?.document.data.hidden ? 'active' : '',\n      //@ts-ignore\n      lockedClass: <string>this.object?.document.data.locked ? 'active' : '',\n      showPerceiveInput: getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.enableLootTokenPerceiveReveal),\n      minPerceiveValue:\n        <number>(<any>this.object?.document.getFlag(PICK_UP_STIX_MODULE_NAME, PICK_UP_STIX_FLAG)).minPerceiveValue ??\n        getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.defaultMinimumPerceiveValue),\n      id: this.id,\n      classes: this.options.classes.join(' '),\n      appId: this.appId,\n      isGM: getGame().user?.isGM,\n      icons: CONFIG.controlIcons,\n    };\n\n    log([data]);\n    return data;\n  }\n}\n"]}