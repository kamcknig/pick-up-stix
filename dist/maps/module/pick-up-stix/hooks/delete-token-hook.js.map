{"version":3,"sources":["module/pick-up-stix/hooks/delete-token-hook.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE,wBAAqB;AACzC,OAAO,EAAE,UAAU,EAAE,0BAAuB;AAE5C,OAAO,EAAE,UAAU,EAAE,YAAY,EAAE,UAAU,EAAE,mBAAe;AAE9D,MAAM,CAAC,MAAM,eAAe,GAAG,KAAK,EAAE,KAAK,EAAE,SAAS,EAAE,OAAO,EAAE,MAAM,EAAE,EAAE;IACzE,GAAG,CAAC,iCAAiC,CAAC,CAAC;IACvC,GAAG,CAAC,CAAC,KAAK,EAAE,SAAS,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC;IAEzC,MAAM,OAAO,GAAc,UAAU,CAAC,UAAU,CAAC,CAAC,EAAa,EAAE,EAAE,CAAC,EAAE,CAAC,OAAO,KAAK,KAAK,CAAC,EAAE,IAAI,EAAE,CAAC,OAAO,KAAK,SAAS,CAAC,GAAG,CAAC,CAAC;IAE7H,IAAI,CAAC,OAAO,EAAE;QACZ,OAAO;KACR;IAED,OAAO,CAAC,mBAAmB,EAAE,CAAC;IAE9B,IAAI,CAAC,UAAU,EAAE,EAAE;QACjB,GAAG,CAAC,uDAAuD,CAAC,CAAC;QAC7D,OAAO;KACR;IAED,MAAM,MAAM,GAAG,WAAW,CAAC,SAAS,EAAE,wCAAwC,CAAC,CAAC;IAEhF,IAAI,MAAM,IAAI,YAAY,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE;QACpE,IAAI,MAAM,EAAE;YACV,GAAG,CAAC,uEAAuE,MAAM,iBAAiB,CAAC,CAAC;YACpG,MAAM,UAAU,CAAC,MAAM,CAAC,CAAC;SAC1B;aACI;YACH,IAAI,CAAC,6EAA6E,CAAC,CAAC;YACpF,OAAO,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;SAC5B;KACF;AACH,CAAC,CAAA","file":"../../../../module/pick-up-stix/hooks/delete-token-hook.js","sourcesContent":["import { log, warn } from \"../../../log\";\r\nimport { amIFirstGm } from \"../../../utils\";\r\nimport { LootToken } from \"../loot-token\"\r\nimport { deleteItem, getLootToken, lootTokens } from \"../main\"\r\n\r\nexport const deleteTokenHook = async (scene, tokenData, options, userId) => {\r\n  log(`pick-up-stix | deleteTokenHook:`);\r\n  log([scene, tokenData, options, userId]);\r\n\r\n  const removed: LootToken = lootTokens.findSplice((lt: LootToken) => lt.sceneId === scene.id && lt.tokenId === tokenData._id);\r\n\r\n  if (!removed) {\r\n    return;\r\n  }\r\n\r\n  removed.deactivateListeners();\r\n\r\n  if (!amIFirstGm()) {\r\n    log(`pick-up-stix | deleteTokenHook | User is not first GM`);\r\n    return;\r\n  }\r\n\r\n  const itemId = getProperty(tokenData, 'flags.pick-up-stix.pick-up-stix.itemId');\r\n\r\n  if (itemId && getLootToken({ itemId: removed?.itemId }).length === 0) {\r\n    if (itemId) {\r\n      log(`pick-up-stix | deleteTokenHook | No LootTokens left, deleting Item '${itemId}' for LootToken`);\r\n      await deleteItem(itemId);\r\n    }\r\n    else {\r\n      warn(`pick-up-stix | deleteTokenHook | Item ID not found on TokenFlags for token:`);\r\n      console.debug([tokenData]);\r\n    }\r\n  }\r\n}\r\n"]}