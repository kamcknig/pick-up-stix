{"version":3,"sources":["module/pick-up-stix/loot-hud-application.ts"],"names":[],"mappings":"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","file":"../../../module/pick-up-stix/loot-hud-application.js","sourcesContent":["import { getLootToken } from \"./main\";\nimport { LootEmitLightConfigApplication } from \"./loot-emit-light-config-application\";\nimport { error, log } from \"../../log\";\nimport { SettingKeys } from \"./settings\";\n\nexport class LootHud extends BasePlaceableHUD<PlaceableObject> {\n  static get defaultOptions() {\n    //@ts-ignore\n    return mergeObject(super.defaultOptions, {\n      height: 'auto',\n      minimizable: false,\n      id: 'loot-hud',\n      resizable: false,\n      template: 'modules/pick-up-stix/module/pick-up-stix/templates/loot-hud.html',\n      classes: ['pick-up-stix', 'loot-hud'].concat(super.defaultOptions.classes)\n    });\n  }\n\n  private get itemId(): string {\n    return <string>this.object.getFlag('pick-up-stix', 'pick-up-stix.itemId');\n  }\n\n  constructor() {\n    super({});\n    log(`pick-up-stix | LootHud ${this.appId} | constructor called with args`);\n    log(LootHud.defaultOptions);\n  }\n\n  activateListeners(html) {\n    log(`pick-up-stix | LootHud ${this.appId} | activateListeners called with args`);\n    log([html]);\n    super.activateListeners(html);\n    html.find(\".config\").click(this.onTokenConfig);\n    html.find(\".locked\").click(this._onToggleItemLocked);\n    html.find(\".emit-light\").click(this.onConfigureLightEmission);\n    html.find(\".visibility-perceive-input\").on('change', this.onPerceiveValueChanged);\n  }\n\n  private onPerceiveValueChanged = (e) => {\n    log(`pick-up-stix | LootHudApplication ${this.appId} | onPerceivedValueChanged`);\n    const val = +e.currentTarget.value;\n    log([val]);\n\n    if (val === undefined || val === null || isNaN(val)) {\n      ui.notifications.error(`Invalid value '${val}'`);\n      return;\n    }\n\n    if (val < 0) {\n      ui.notifications.error(`Minimum perceived value must be 0`);\n      return;\n    }\n\n    this.object.update({\n      flags: {\n        'pick-up-stix': {\n          'pick-up-stix': {\n            minPerceiveValue: val\n          }\n        }\n      }\n    });\n  }\n\n  private onConfigureLightEmission = async (event) => {\n    log(`pick-up-stix | LootHud ${this.appId} | _onConfigureLightEmission`);\n    const f = new LootEmitLightConfigApplication(this.object, {}).render(true);\n  }\n\n  private _onToggleItemLocked = async (event) => {\n    log(`pick-up-stix | LootHud ${this.appId} | _onToggleItemLocked`);\n    const lootToken = getLootToken({ itemId: this.itemId, tokenId: this.object.id })?.[0];\n\n    if (!lootToken) {\n      error(`No valid LootToken instance found for token '${this.object.id}' and Item id '${this.itemId}'`);\n      return;\n    }\n\n    await lootToken.toggleLocked();\n    this.render();\n  }\n\n  private onTokenConfig = async (event) => {\n    log(`pick-up-stix | LootHud ${this.appId} | _onTokenConfig`);\n\n    const item = game.items.get(this.itemId);\n    item.sheet.render(true, { renderData: { sourceToken: this.object.data._id }});\n  }\n\n  getData(options) {\n    log(`pick-up-stix | LootHud ${this.appId} | getData`);\n    const lootData = getLootToken({ itemId: this.itemId, tokenId: this.object.id })?.[0];;\n    if (!lootData) {\n      error(`No valid LootToken instance found for token '${this.object.id}' on scene '${this.object.scene.id}'`);\n    }\n\n    const data = {\n      canConfigure: game.user.can(\"TOKEN_CONFIGURE\"),\n      //@ts-ignore\n      visibilityClass: this.object.data.hidden ? 'active' : '',\n      //@ts-ignore\n      lockedClass: this.object.data.locked ? 'active' : '',\n      showPerceiveInput: game.settings.get('pick-up-stix', SettingKeys.enableLootTokenPerceiveReveal),\n      minPerceiveValue: this.object.getFlag('pick-up-stix', 'pick-up-stix.minPerceiveValue') ?? game.settings.get('pick-up-stix', SettingKeys.defaultMinimumPerceiveValue),\n      id: this.id,\n      classes: this.options.classes.join(\" \"),\n      appId: this.appId,\n      isGM: game.user.isGM,\n      icons: CONFIG.controlIcons\n    };\n\n    log([data]);\n    return data;\n  }\n}\n"]}