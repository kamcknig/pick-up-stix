{"version":3,"sources":["module/utils.ts"],"names":[],"mappings":"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","file":"../../module/utils.js","sourcesContent":["// import { DND5E } from '../../systems/dnd5e/module/config.js';\n\nimport { log, warn } from '../main';\nimport { TokenFlags } from './loot-token';\nimport { getCanvas, getGame, PICK_UP_STIX_FLAG, PICK_UP_STIX_MODULE_NAME, SettingKeys } from './settings';\n\n// get the distance to the token and if it's too far then can't pick it up\nexport const dist = (p1: PlaceableObject, p2: PlaceableObject): number => {\n  return Math.hypot(p1.x - p2.x, p1.y - p2.y);\n};\n\nexport const getCurrencyTypes = (): { [short: string]: string } => {\n  log(` utils | getCurrencies`);\n  if (getGame().system.id === 'dnd5e') {\n    log(` utils | getCurrencies | using system 'dnd5e'`);\n    //@ts-ignore\n    import('../../systems/dnd5e/module/config.js').then((r) => {\n      return {\n        ...r.DND5E.currencies,\n      };\n    });\n  } else if (getGame().system.id === 'D35E') {\n    return {\n      cp: 'Copper',\n      gp: 'Gold',\n      pp: 'Platinum',\n      sp: 'Silver',\n    };\n  } else if (getGame().system.id === 'pf2e') {\n    return {\n      cp: 'Copper',\n      gp: 'Gold',\n      pp: 'Platinum',\n      sp: 'Silver',\n    };\n  } else {\n    warn(`System ${getGame().system.id} currencies have not been implemented and therefore might not work properly.`);\n  }\n\n  return {\n    pp: 'Platinum',\n    ep: 'Electrum',\n    gp: 'Gold',\n    sp: 'Silver',\n    cp: 'Copper',\n  };\n};\n\nexport const versionDiff = (v1: string = '0.0.0', v2: string = '0.0.0'): number => {\n  const v1Parts: number[] = v1.split('.').map((v) => Number(v));\n  const v2Parts: number[] = v2.split('.').map((v) => Number(v));\n\n  if (v1Parts[0] === v2Parts[0]) {\n    if (v1Parts[1] === v2Parts[1]) {\n      return v1Parts[2] - v2Parts[2];\n    }\n    return v1Parts[1] - v2Parts[1];\n  }\n  return v1Parts[0] - v2Parts[0];\n};\n\nexport const collidedTokens = (options: { x: number; y: number }): Token[] => {\n  return <Token[]>(\n    getCanvas().tokens?.placeables.filter(\n      (p: PlaceableObject) =>\n        options.x <= p.x + p.width - 1 && options.x >= p.x && options.y <= p.y + p.height - 1 && options.y >= p.y,\n    )\n  );\n};\n\nexport function onChangeInputDelta(event) {\n  log(` onChangeInputDelta`);\n  log([event]);\n  const input = event.target;\n  const value = input.value;\n  if (['+', '-'].includes(value[0])) {\n    let delta = parseFloat(value);\n    input.value = Math.max(+getProperty(this, input.name) + +delta, 0);\n  } else if (value[0] === '=') {\n    input.value = Math.max(+value.slice(1), 0);\n  }\n}\n\nexport function getQuantityDataPath(): string {\n  let path;\n\n  switch (getGame().system.id) {\n    case 'dnd5e':\n      path = 'quantity';\n      break;\n    case 'D35E':\n      path = 'quantity';\n      break;\n    case 'pf2e':\n      path = 'quantity.value';\n      break;\n    default:\n      warn(\n        `System ${getGame().system.id} quantity data path not implemented and therefore might not work with item data.`,\n      );\n      path = 'quantity';\n      break;\n  }\n\n  return path;\n}\n\nexport function getPriceDataPath(): string {\n  let path;\n\n  switch (getGame().system.id) {\n    case 'dnd5e':\n      path = 'price';\n      break;\n    case 'D35E':\n      path = 'price';\n      break;\n    case 'pf2e':\n      path = 'price.value';\n      break;\n    default:\n      warn(\n        `System ${getGame().system.id} price data path not implemented and therefore might not work with item data.`,\n      );\n      path = 'price';\n      break;\n  }\n\n  return path;\n}\n\nexport function getWeightDataPath(): string {\n  let path;\n\n  switch (getGame().system.id) {\n    case 'dnd5e':\n      path = 'weight';\n      break;\n    case 'D35E':\n      path = 'weight';\n      break;\n    case 'pf2e':\n      path = 'weight.value';\n      break;\n    default:\n      warn(\n        `System ${getGame().system.id} weight data path not implemented and therefore might not work with item data.`,\n      );\n      path = 'weight';\n      break;\n  }\n\n  return path;\n}\n\nexport const getActorCurrencyPath = (): string => {\n  let path;\n\n  switch (getGame().system.id) {\n    case 'dnd5e':\n    case 'D35E':\n    case 'pf2e':\n      path = 'data.currency';\n      break;\n    default:\n      warn(\n        `System ${getGame().system.id} quantity data path not implemented and therefore might not work with item data.`,\n      );\n      path = 'data.currency';\n      break;\n  }\n\n  return path;\n};\n\nexport const amIFirstGm = (): boolean => {\n  const firstGm = <User>firstGM();\n  return firstGm && getGame().user === firstGm;\n};\n\nexport const firstGM = () => {\n  const firstGm = getGame().users?.find((u) => u.isGM && u.active);\n  return firstGm;\n};\n\nexport class Util {\n  static joinStrings(arr: string[], separator: string = ':') {\n    if (arr.length === 0) return '';\n    return arr.reduce((v1, v2) => `${v1}${separator}${v2}`);\n  }\n}\nexport const canSeeLootToken = (token): boolean => {\n  const tokenFlags: TokenFlags = token.getFlag(PICK_UP_STIX_MODULE_NAME, PICK_UP_STIX_FLAG);\n\n  // right now this is dnd5e only so this code is speicific to that\n  const minPerceive =\n    tokenFlags?.minPerceiveValue ??\n    getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.defaultMinimumPerceiveValue);\n\n  const tolerance = Math.min(token.w, token.h) / 4;\n\n  return <boolean>(getCanvas().sight?.testVisibility(token.center, { tolerance }) &&\n    getCanvas().tokens?.controlled.some((t) => {\n      //@ts-ignore\n      t.actor?.data?.data?.skills?.prc?.passive >= minPerceive;\n    }));\n};\n\nexport const initiateRecord = function <Y>(enumX: { [index: string]: any }, defaultValue: Y): Record<string, Y> {\n  return Object.assign({}, ...Object.keys(enumX).map((x) => ({ [x]: defaultValue })));\n};\n"]}