{"version":3,"sources":["module/utils.ts"],"names":[],"mappings":"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","file":"../../module/utils.js","sourcesContent":["\r\n// import { DND5E } from '../../systems/dnd5e/module/config.js';\r\n\r\nimport { log, warn } from '../main';\r\nimport { TokenFlags } from './loot-token';\r\nimport { getCanvas, getGame, PICK_UP_STIX_FLAG, PICK_UP_STIX_MODULE_NAME, SettingKeys } from './settings';\r\n\r\n// get the distance to the token and if it's too far then can't pick it up\r\nexport const dist = (p1: PlaceableObject, p2: PlaceableObject): number => {\r\n  return Math.hypot(p1.x - p2.x, p1.y - p2.y);\r\n};\r\n\r\nexport const getCurrencyTypes = (): { [short: string]: string } =>  {\r\n  log(` utils | getCurrencies`);\r\n  if (getGame().system.id === 'dnd5e') {\r\n    log(` utils | getCurrencies | using system 'dnd5e'`);\r\n    //@ts-ignore\r\n    import('../../systems/dnd5e/module/config.js').then(r => {\r\n      return {\r\n        ...r.DND5E.currencies\r\n      };\r\n    });\r\n  }\r\n  else if (getGame().system.id === 'D35E') {\r\n    return {\r\n      cp: 'Copper',\r\n      gp: 'Gold',\r\n      pp: 'Platinum',\r\n      sp: 'Silver'\r\n    }\r\n  }\r\n  else if (getGame().system.id === 'pf2e') {\r\n    return {\r\n      cp: 'Copper',\r\n      gp: 'Gold',\r\n      pp: 'Platinum',\r\n      sp: 'Silver'\r\n    }\r\n  }\r\n  else {\r\n    warn(`System ${getGame().system.id} currencies have not been implemented and therefore might not work properly.`);\r\n  }\r\n\r\n  return {\r\n    pp: 'Platinum',\r\n    ep: 'Electrum',\r\n    gp: 'Gold',\r\n    sp: 'Silver',\r\n    cp: 'Copper'\r\n  };\r\n}\r\n\r\nexport const versionDiff = (v1: string = '0.0.0', v2: string = '0.0.0'): number => {\r\n  const v1Parts: number[] = v1.split('.').map(v => Number(v));\r\n  const v2Parts: number[] = v2.split('.').map(v => Number(v));\r\n\r\n  if (v1Parts[0] === v2Parts[0]) {\r\n    if (v1Parts[1] === v2Parts[1]) {\r\n      return v1Parts[2] - v2Parts[2];\r\n    }\r\n    return v1Parts[1] - v2Parts[1];\r\n  }\r\n  return v1Parts[0] - v2Parts[0];\r\n}\r\n\r\nexport const collidedTokens = (options: { x: number, y:number }): Token[] => {\r\n  return <Token[]>getCanvas().tokens?.placeables.filter((p: PlaceableObject) =>\r\n    options.x <= p.x + p.width - 1 && options.x >= p.x && options.y <= p.y + p.height - 1 && options.y >= p.y\r\n  );\r\n}\r\n\r\nexport function onChangeInputDelta(event) {\r\n  log(` onChangeInputDelta`);\r\n  log([event]);\r\n  const input = event.target;\r\n  const value = input.value;\r\n  if ( ['+', '-'].includes(value[0]) ) {\r\n    let delta = parseFloat(value);\r\n    input.value = Math.max(+getProperty(this, input.name) + +delta, 0);\r\n  } else if ( value[0] === '=' ) {\r\n    input.value = Math.max(+value.slice(1), 0);\r\n  }\r\n}\r\n\r\nexport function getQuantityDataPath(): string {\r\n  let path;\r\n\r\n  switch (getGame().system.id) {\r\n    case 'dnd5e':\r\n      path = 'quantity'\r\n      break;\r\n    case 'D35E':\r\n      path = 'quantity'\r\n      break;\r\n    case 'pf2e':\r\n      path = 'quantity.value'\r\n      break;\r\n    default:\r\n      warn(`System ${getGame().system.id} quantity data path not implemented and therefore might not work with item data.`);\r\n      path = 'quantity';\r\n      break;\r\n  }\r\n\r\n  return path;\r\n}\r\n\r\nexport function getPriceDataPath(): string {\r\n  let path;\r\n\r\n  switch (getGame().system.id) {\r\n    case 'dnd5e':\r\n      path = 'price'\r\n      break;\r\n    case 'D35E':\r\n      path = 'price'\r\n      break;\r\n    case 'pf2e':\r\n      path = 'price.value'\r\n      break;\r\n    default:\r\n      warn(`System ${getGame().system.id} price data path not implemented and therefore might not work with item data.`);\r\n      path = 'price';\r\n      break;\r\n  }\r\n\r\n  return path;\r\n}\r\n\r\nexport function getWeightDataPath(): string {\r\n  let path;\r\n\r\n  switch (getGame().system.id) {\r\n    case 'dnd5e':\r\n      path = 'weight'\r\n      break;\r\n    case 'D35E':\r\n      path = 'weight'\r\n      break;\r\n    case 'pf2e':\r\n      path = 'weight.value'\r\n      break;\r\n    default:\r\n      warn(`System ${getGame().system.id} weight data path not implemented and therefore might not work with item data.`);\r\n      path = 'weight';\r\n      break;\r\n  }\r\n\r\n  return path;\r\n}\r\n\r\nexport const getActorCurrencyPath = (): string => {\r\n  let path;\r\n\r\n  switch (getGame().system.id) {\r\n    case 'dnd5e':\r\n    case 'D35E':\r\n    case 'pf2e':\r\n      path = 'data.currency'\r\n      break;\r\n    default:\r\n      warn(`System ${getGame().system.id} quantity data path not implemented and therefore might not work with item data.`);\r\n      path = 'data.currency';\r\n      break;\r\n  }\r\n\r\n  return path;\r\n}\r\n\r\nexport const amIFirstGm = (): boolean => {\r\n  const firstGm = <User>firstGM();\r\n  return firstGm && (getGame().user === firstGm)\r\n}\r\n\r\nexport const firstGM = () => {\r\n  const firstGm = getGame().users?.find(u => u.isGM && u.active);\r\n  return firstGm;\r\n}\r\n\r\nexport class Util {\r\n\r\n  static joinStrings(arr: string[], separator: string = \":\") {\r\n      if (arr.length === 0) return \"\";\r\n      return arr.reduce((v1, v2) => `${v1}${separator}${v2}`);\r\n  }\r\n\r\n}\r\nexport const canSeeLootToken = (token): boolean => {\r\n  const tokenFlags: TokenFlags = token.getFlag(PICK_UP_STIX_MODULE_NAME, PICK_UP_STIX_FLAG);\r\n\r\n  // right now this is dnd5e only so this code is speicific to that\r\n  const minPerceive = tokenFlags?.minPerceiveValue ?? getGame().settings.get(PICK_UP_STIX_MODULE_NAME, SettingKeys.defaultMinimumPerceiveValue);\r\n\r\n  const tolerance = Math.min(token.w, token.h) / 4;\r\n\r\n  return <boolean>(getCanvas().sight?.testVisibility(token.center, {tolerance}) \r\n    && getCanvas().tokens?.controlled.some(t => {\r\n      //@ts-ignore\r\n      t.actor?.data?.data?.skills?.prc?.passive >= minPerceive\r\n    }))\r\n}\r\n\r\nexport const initiateRecord = function<Y> (enumX: {[index: string]: any}, defaultValue: Y): Record<string,Y> {\r\n  return Object.assign({},...Object.keys(enumX).map(x=>({[x]:defaultValue})))\r\n}"]}