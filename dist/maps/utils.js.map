{"version":3,"sources":["utils.ts"],"names":[],"mappings":"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","file":"../utils.js","sourcesContent":["//@ts-ignore\n// import { DND5E } from  ../../systems/dnd5e/module/config.js\";\n\nimport { log, warn } from './log';\nimport { TokenFlags } from './module/pick-up-stix/loot-token';\nimport { getCanvas, SettingKeys } from './module/pick-up-stix/settings';\n\n// get the distance to the token and if it's too far then can't pick it up\nexport const dist = (p1: PlaceableObject, p2: PlaceableObject): number => {\n  return Math.hypot(p1.x - p2.x, p1.y - p2.y);\n};\n\nexport const getCurrencyTypes = (): { [short: string]: string } =>  {\n  log(`pick-up-stix | utils | getCurrencies`);\n  if (game.system.id === 'dnd5e') {\n    log(`pick-up-stix | utils | getCurrencies | using system 'dnd5e'`);\n    //@ts-ignore\n    import('../../systems/dnd5e/module/config.js').then(r => {\n      return {\n        ...r.DND5E.currencies\n      };\n    });\n  }\n  else if (game.system.id === 'D35E') {\n    return {\n      cp: 'Copper',\n      gp: 'Gold',\n      pp: 'Platinum',\n      sp: 'Silver'\n    }\n  }\n  else if (game.system.id === 'pf2e') {\n    return {\n      cp: 'Copper',\n      gp: 'Gold',\n      pp: 'Platinum',\n      sp: 'Silver'\n    }\n  }\n  else {\n    warn(`System ${game.system.id} currencies have not been implemented and therefore might not work properly.`);\n  }\n\n  return {\n    pp: 'Platinum',\n    ep: 'Electrum',\n    gp: 'Gold',\n    sp: 'Silver',\n    cp: 'Copper'\n  };\n}\n\nexport const versionDiff = (v1: string = '0.0.0', v2: string = '0.0.0'): number => {\n  const v1Parts: number[] = v1.split('.').map(v => Number(v));\n  const v2Parts: number[] = v2.split('.').map(v => Number(v));\n\n  if (v1Parts[0] === v2Parts[0]) {\n    if (v1Parts[1] === v2Parts[1]) {\n      return v1Parts[2] - v2Parts[2];\n    }\n    return v1Parts[1] - v2Parts[1];\n  }\n  return v1Parts[0] - v2Parts[0];\n}\n\nexport const collidedTokens = (options: { x: number, y:number }): Token[] => {\n  return getCanvas().tokens.placeables.filter((p: PlaceableObject) =>\n    options.x <= p.x + p.width - 1 && options.x >= p.x && options.y <= p.y + p.height - 1 && options.y >= p.y\n  );\n}\n\nexport function onChangeInputDelta(event) {\n  log(`pick-up-stix | onChangeInputDelta`);\n  log([event]);\n  const input = event.target;\n  const value = input.value;\n  if ( ['+', '-'].includes(value[0]) ) {\n    let delta = parseFloat(value);\n    input.value = Math.max(+getProperty(this, input.name) + +delta, 0);\n  } else if ( value[0] === '=' ) {\n    input.value = Math.max(+value.slice(1), 0);\n  }\n}\n\nexport function getQuantityDataPath(): string {\n  let path;\n\n  switch (game.system.id) {\n    case 'dnd5e':\n      path = 'quantity'\n      break;\n    case 'D35E':\n      path = 'quantity'\n      break;\n    case 'pf2e':\n      path = 'quantity.value'\n      break;\n    default:\n      warn(`System ${game.system.id} quantity data path not implemented and therefore might not work with item data.`);\n      path = 'quantity';\n      break;\n  }\n\n  return path;\n}\n\nexport function getPriceDataPath(): string {\n  let path;\n\n  switch (game.system.id) {\n    case 'dnd5e':\n      path = 'price'\n      break;\n    case 'D35E':\n      path = 'price'\n      break;\n    case 'pf2e':\n      path = 'price.value'\n      break;\n    default:\n      warn(`System ${game.system.id} price data path not implemented and therefore might not work with item data.`);\n      path = 'price';\n      break;\n  }\n\n  return path;\n}\n\nexport function getWeightDataPath(): string {\n  let path;\n\n  switch (game.system.id) {\n    case 'dnd5e':\n      path = 'weight'\n      break;\n    case 'D35E':\n      path = 'weight'\n      break;\n    case 'pf2e':\n      path = 'weight.value'\n      break;\n    default:\n      warn(`System ${game.system.id} weight data path not implemented and therefore might not work with item data.`);\n      path = 'weight';\n      break;\n  }\n\n  return path;\n}\n\nexport const getActorCurrencyPath = (): string => {\n  let path;\n\n  switch (game.system.id) {\n    case 'dnd5e':\n    case 'D35E':\n    case 'pf2e':\n      path = 'data.currency'\n      break;\n    default:\n      warn(`System ${game.system.id} quantity data path not implemented and therefore might not work with item data.`);\n      path = 'data.currency';\n      break;\n  }\n\n  return path;\n}\n\nexport const amIFirstGm = (): boolean => {\n  const firstGm = firstGM();\n  return firstGm && game.user === firstGm\n}\n\nexport const firstGM = () => {\n  const firstGm = game.users.find(u => u.isGM && u.active);\n  return firstGm;\n}\n\nexport class Util {\n\n  static joinStrings(arr: string[], separator: string = \":\") {\n      if (arr.length === 0) return \"\";\n      return arr.reduce((v1, v2) => `${v1}${separator}${v2}`);\n  }\n\n}\nexport const canSeeLootToken = (token): boolean => {\n  const tokenFlags: TokenFlags = token.getFlag('pick-up-stix', 'pick-up-stix');\n\n  // right now this is dnd5e only so this code is speicific to that\n  const minPerceive = tokenFlags?.minPerceiveValue ?? game.settings.get('pick-up-stix', SettingKeys.defaultMinimumPerceiveValue);\n\n  const tolerance = Math.min(token.w, token.h) / 4;\n\n  return (getCanvas().sight.testVisibility(token.center, {tolerance}) && getCanvas().tokens.controlled.some(t => t.actor?.data?.data?.skills?.prc?.passive >= minPerceive))\n}\n"]}