{"version":3,"sources":["module/pick-up-stix/hooks.ts"],"names":[],"mappings":"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","file":"../../../src/module/pick-up-stix/hooks.js","sourcesContent":["/* ------------------------------------ */\r\n/* When ready\t\t\t\t\t\t\t\t\t\t\t\t\t  */\r\nimport ItemConfigApplication from \"./item-config-application\";\r\nimport {\r\n\tdrawLockIcon,\r\n\thandleDropItem,\r\n\tlootTokens,\r\n\tsetupMouseManager\r\n} from \"./main\";\r\nimport { ItemType, PickUpStixFlags, PickUpStixSocketMessage, SocketMessageType } from \"./models\";\r\nimport { handleOnDrop } from \"./overrides\";\r\nimport { preloadTemplates } from \"./preloadTemplates\";\r\nimport { DefaultSetttingKeys, registerSettings } from \"./settings\";\r\n\r\n/**\r\n * TODO: This should be removed once 0.7.0 becomes stable\r\n */\r\ndeclare class DragDrop {\r\n\tconstructor(options: DragDropOptions);\r\n\r\n\tbind(canvas: any);\r\n}\r\n\r\ndeclare class EntitySheetConfig {\r\n\tstatic registerSheet(\r\n    entityClass,\r\n    scope,\r\n    sheetClass,\r\n    { types, makeDefault }?: { types?: string[], makeDefault?: boolean }\r\n  );\r\n}\r\n\r\n/**\r\n * TODO: This should be removed once 0.7.0 becomes stable\r\n */\r\ndeclare interface DragDropOptions {\r\n\tdragSelector?;\r\n\tdropSelector?;\r\n\tpermissions?;\r\n\tcallbacks?;\r\n}\r\n\r\n/* ------------------------------------ */\r\n/* Initialize module\t\t\t\t\t*/\r\n/* ------------------------------------ */\r\nexport async function initHook() {\r\n\tconsole.log('pick-up-stix | initHook');\r\n\r\n\t// CONFIG.debug.hooks = true;\r\n\r\n\t// Assign custom classes and constants here\r\n\r\n\t// Register custom module settings\r\n\tregisterSettings();\r\n\r\n\t// Preload Handlebars templates\r\n\tawait preloadTemplates();\r\n\r\n\tHandlebars.registerHelper('capitalize', (input: string) => {\r\n\t\treturn `${input[0].toUpperCase()} ${input.slice(1)}`;\r\n\t});\r\n\r\n\t// Register custom sheets (if any)\r\n};\r\n\r\nexport async function setupHook() {\r\n\tconsole.log(`pick-up-stix | setupHook`);\r\n}\r\n\r\n/* ------------------------------------ */\r\nexport function readyHook() {\r\n\t// Do anything once the module is ready\r\n\tconsole.log(`pick-up-stix | readyHook`);\r\n\r\n\tfor (let item of game.items.values()) {\r\n\t\tif (getProperty(item.data, 'flags.pick-up-stix.pick-up-stix.itemType') === ItemType.CONTAINER) {\r\n\t\t\titem.data.type = 'container';\r\n\t\t}\r\n\t}\r\n\r\n\tgame.system.entityTypes.Item.push('container');\r\n\tCONFIG.Item.sheetClasses['container'] = {\r\n\t\t'pick-up-stix.ItemConfigApplication': {\r\n\t\t\tcls: ItemConfigApplication,\r\n\t\t\tdefault: true,\r\n\t\t\tid: 'pick-up-stix.ItemConfigApplication'\r\n\t\t}\r\n\t};\r\n\tEntitySheetConfig.registerSheet(Item, 'pick-up-stix', ItemConfigApplication, { types: [ 'container' ], makeDefault: true });\r\n\r\n\tsocket = game.socket;\r\n\r\n\tsocket.on('module.pick-up-stix', async (msg: PickUpStixSocketMessage) => {\r\n\t\tconsole.log(`pick-up-stix | socket.on | received socket message with args:`);\r\n\t\tconsole.log(msg);\r\n\r\n\t\tif (msg.sender === game.user.id) {\r\n\t\t\tconsole.log(`pick-up-stix | socket.on | i sent this, ignoring`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst firstGm = game.users.find((u) => u.isGM && u.active);\r\n\t\tif (firstGm && game.user !== firstGm) {\r\n   \t\treturn;\r\n\t\t}\r\n\r\n\t\tlet actor;\r\n\t\tlet token;\r\n\r\n\t\tswitch (msg.type) {\r\n\t\t\tcase SocketMessageType.updateActor:\r\n\t\t\t\tactor = game.actors.get(msg.data.actorId);\r\n\t\t\t\tawait actor.update(msg.data.updates);\r\n\t\t\t\tbreak;\r\n\t\t\tcase SocketMessageType.deleteToken:\r\n\t\t\t\tawait canvas.scene.deleteEmbeddedEntity('Token', msg.data);\r\n\t\t\t\tbreak;\r\n\t\t\tcase SocketMessageType.updateToken:\r\n\t\t\t\ttoken = canvas.tokens.get(msg.data.tokenId);\r\n\t\t\t\tawait token.update(msg.data.updates);\r\n\t\t\t\tbreak;\r\n\t\t\tcase SocketMessageType.createOwnedEntity:\r\n\t\t\t\tactor = game.actors.get(msg.data.actorId);\r\n\t\t\t\tawait actor.createOwnedItem(msg.data.items);\r\n\t\t\t\tbreak;\r\n\t\t\tcase SocketMessageType.createItemToken:\r\n\t\t\t\tawait Token.create(msg.data);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t});\r\n};\r\n\r\nlet boardDropListener;\r\nconst dropCanvasHandler = async (canvas, dropData) => {\r\n\tconsole.log(`pick-up-stix | dropCanvasData | called with args:`);\r\n\tconsole.log(canvas, dropData);\r\n\r\n\tif (dropData.type === \"Item\") {\r\n\t\thandleDropItem(dropData);\r\n\t}\r\n}\r\n\r\nexport async function onCanvasReady(...args) {\r\n\tconsole.log(`pick-up-stix | onCanvasReady | call width args:`);\r\n\tconsole.log(args);\r\n\tconsole.log(game.user);\r\n\r\n  canvas?.tokens?.placeables?.forEach(async (p: PlaceableObject) => {\r\n\t\tconst flags: PickUpStixFlags = p.getFlag('pick-up-stix', 'pick-up-stix');\r\n\r\n\t\tif (flags) {\r\n\t\t\tconsole.log(`pick-up-stix | onCanvasReady | found token ${p.id} with itemData`);\r\n\t\t\tp.mouseInteractionManager = setupMouseManager.bind(p)();\r\n\r\n\t\t\tif (flags.isLocked) {\r\n\t\t\t\tconsole.log(`pick-up-stix | onCanvasReady | loot is locked, draw lock icon`);\r\n\t\t\t\tawait drawLockIcon(p);\r\n\t\t\t}\r\n\t\t}\r\n  });\r\n\r\n\tconst coreVersion: string = game.data.version;\r\n\tif (isNewerVersion(coreVersion, '0.6.5')) {\r\n    console.log(`pick-up-stix | onCanvasReady | Foundry version newer than 0.6.5. Using dropCanvasData hook`);\r\n\r\n\t\tHooks.off('dropCanvasData', dropCanvasHandler);\r\n\t\tHooks.on('dropCanvasData', dropCanvasHandler);\r\n\t}\r\n\telse {\r\n\t\tconsole.log(`pick-up-stix | onCanvasReady | Foundry version is 0.6.5 or below. Overriding Canvas._onDrop`);\r\n\r\n\t\tconst board = document.getElementById('board');\r\n\t\tif (boardDropListener) {\r\n\t\t\tboard.removeEventListener('drop', boardDropListener);\r\n\t\t}\r\n\r\n\t\tboardDropListener = handleOnDrop.bind(canvas);\r\n\t\tboard.addEventListener('drop', boardDropListener);\r\n\t}\r\n}\r\n\r\nexport async function onPreCreateOwnedItem(actor: Actor, itemData: any, options: any, userId: string) {\r\n\tconsole.log(`pick-up-stix | onPreCreateOwnedItem | called with args:`);\r\n\tconsole.log([actor, itemData, options, userId]);\r\n\r\n\tlet owner: { actorId: string, itemId: string };\r\n\tif (owner = getProperty(itemData.flags, 'pick-up-stix.pick-up-stix.owner')) {\r\n\t\t// if the item is already owned by someone else, set the new actor as the owner and\r\n\t\t// delete the item from the old owner\r\n\t\tsetProperty(itemData.flags, 'pick-up-stix.pick-up-stix.owner', { actorId: actor.id });\r\n\t\tconst ownerActor = game.actors.get(owner.actorId);\r\n\t\tawait ownerActor.deleteOwnedItem(itemData._id);\r\n\t\treturn;\r\n\t}\r\n\r\n\tsetProperty(itemData.flags, 'pick-up-stix.pick-up-stix', {\r\n\t\towner: {\r\n\t\t\tactorId: actor.id\r\n\t\t},\r\n\t\tinitialState: { id: itemData._id, count: 1, itemData: { ...itemData, flags: {} } },\r\n\t\titemType: ItemType.ITEM,\r\n\t\tisLocked: false\r\n\t});\r\n};\r\n\r\nexport function onDeleteToken(scene: Scene, tokenData: any, data: any, userId: string) {\r\n\tconsole.log(`pick-up-stix | onDeleteToken | called with args:`);\r\n\tconsole.log([scene, tokenData, data, userId]);\r\n\tlootTokens.findSplice(t => t === tokenData._id);\r\n}\r\n\r\nexport async function onUpdateToken(scene: Scene, tokenData: any, tokenFlags: any, userId: string) {\r\n  console.log(`pick-up-stix | onUpdateToken | called with args:`)\r\n  console.log([scene, tokenData, tokenFlags, userId]);\r\n\r\n  const flags = getProperty(tokenData, 'flags.pick-up-stix.pick-up-stix');\r\n\r\n\tif (flags) {\r\n      console.log(`pick-up-stix | onUpdateToken | found flags on token data, add mouse interaction`);\r\n\t\t\tconst token: Token = canvas?.tokens?.placeables?.find((p: PlaceableObject) => p.id === tokenData._id);\r\n\r\n\t\t\tif (flags.isLocked) {\r\n\t\t\t\tconsole.log(`pick-up-stix | onUpdateToken | token is locked, draw lock icon`);\r\n\t\t\t\tawait new Promise(resolve => {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tdrawLockIcon(token);\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.log(`pick-up-stix | onUpdateToken | token is not locked, check for locked image`);\r\n\t\t\t\ttoken.children.forEach(c => console.log(c.name));\r\n\r\n\t\t\t\tconst lock = token.getChildByName('pick-up-stix-lock');\r\n\r\n\t\t\t\tconsole.log(`pick-up-stix | onUpdateToken | lock image ${!!lock ? ' found' : ' not found'}`);\r\n\r\n\t\t\t\tif (lock) {\r\n\t\t\t\t\ttoken.removeChild(lock);\r\n\t\t\t\t\tlock.destroy();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttoken.mouseInteractionManager = setupMouseManager.bind(token)();\r\n\t\t\ttoken.activateListeners = setupMouseManager.bind(token);\r\n\t}\r\n};\r\n\r\nexport async function onCreateToken(scene: Scene, tokenData: any, options: any, userId: string) {\r\n  console.log(`pick-up-stix | onCreateToken | called with args:`);\r\n  console.log([scene, tokenData, options, userId]);\r\n\r\n  const flags = getProperty(tokenData, 'flags.pick-up-stix.pick-up-stix');\r\n\r\n\tif (flags) {\r\n      console.log(`pick-up-stix | onCreateToken | found flags on token data, add mouse interaction`);\r\n      const token: Token = canvas?.tokens?.placeables?.find((p: PlaceableObject) => p.id === tokenData._id);\r\n\t\t\ttoken.mouseInteractionManager = setupMouseManager.bind(token)();\r\n\t\t\ttoken.activateListeners = setupMouseManager.bind(token);\r\n\t}\r\n};\r\n\r\nexport async function onRenderDialog(dialog: Dialog, html, dialogOptions) {\r\n\tconsole.log(`pick-up-stix | onRenderDialog | called with args:`);\r\n\tconsole.log([dialog, html, dialogOptions]);\r\n\r\n\tif ((dialog as any).data.title !== 'Create New Item') {\r\n\t\t\treturn;\r\n\t}\r\n\r\n\tconsole.log(`pick-up-stix | onRenderDialog | Dialog is the create new item dialog`);\r\n\t$(html).find('select[name=\"type\"]').append(`<option value=\"Container\">Container</option>`);\r\n}\r\n\r\nexport async function onCreateItem(item: Item, options: any, userId: string) {\r\n\tconsole.log(`pick-up-stix | onCreateItem | called with args:`);\r\n\tconsole.log([item, options, userId]);\r\n\r\n\t// change the type back to 'container' so that our item config sheet works. When the item is created, we created it with\r\n\t// the 'backpack' type because we are forced to use an existing item type. but then after we make it just switch it back.\r\n\tif (getProperty(item.data, 'flags.pick-up-stix.pick-up-stix.itemType') === ItemType.CONTAINER) {\r\n\t\titem.data.type = 'container';\r\n\t}\r\n}\r\n\r\nexport async function onPreCreateItem(itemData: any, options: any, userId: string) {\r\n\tconsole.log(`pick-up-stix | onPreCreateItem | called with args:`);\r\n\tconsole.log([itemData, options, userId]);\r\n\r\n\tif (itemData.type === ItemType.CONTAINER) {\r\n\t\toptions.renderSheet = false;\r\n\t\titemData.type = game.system.entityTypes.Item.includes('backpack') ? 'backpack' : game.system.entityTypes.Item[0];\r\n\t\tsetProperty(itemData, 'flags.pick-up-stix.pick-up-stix.itemType', ItemType.CONTAINER);\r\n\t\tsetProperty(itemData, 'img', game.settings.get('pick-up-stix', DefaultSetttingKeys.closeImagePath));\r\n\t\tsetProperty(itemData, 'flags.pick-up-stix.pick-up-stix.imageContainerOpenPath', game.settings.get('pick-up-stix', DefaultSetttingKeys.openImagePath));\r\n\t\tsetProperty(itemData, 'flags.pick-up-stix.pick-up-stix.imageContainerClosedPath', game.settings.get('pick-up-stix', DefaultSetttingKeys.closeImagePath));\r\n\t}\r\n}\r\n"]}